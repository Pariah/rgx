#!/bin/bash
set -e

REPO_ROOT="$(git rev-parse --show-toplevel)"
cd "$REPO_ROOT"

echo "ðŸ”§ Pre-commit: formatting & auto-fix..."

# 1. Format Rust
if ! cargo fmt --check > /dev/null 2>&1; then
    echo "  â†’ Formatting Rust..."
    cargo fmt
fi

# 2. Auto-fix clippy warnings
echo "  â†’ Running clippy auto-fix..."
cargo clippy --fix --allow-dirty --allow-staged 2>/dev/null || echo "  âš  clippy fix had issues (non-fatal)"

# 3. Stage any fixes
if ! git diff --quiet; then
    echo "  â†’ Staging auto-fixes..."
    git add -A
fi

echo "âœ… Pre-commit done"
